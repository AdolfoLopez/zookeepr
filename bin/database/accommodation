#!/bin/sh

psql -c "SELECT
    person.lastname || ', ' || person.firstname,
    checkin,
    checkout,
    accommodation_location.name
FROM
    person,
    registration,
    accommodation_location,
    accommodation_option
WHERE
    (
        registration.id IN (
            SELECT
                rego
            FROM
                rego_invoice_payment
            WHERE
                payment > 0
        )
        OR
        registration.id IN (
            SELECT
                id
            FROM
                speaker_rego
        )
    )
    AND
    accommodation_option_id = accommodation_option.id
    AND
    accommodation_location_id = accommodation_location.id
    AND
    registration.person_id = person.id
ORDER BY
    accommodation_location.name,
    person.lastname,
    person.firstname
" 
