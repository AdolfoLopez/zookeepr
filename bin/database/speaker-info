#!/usr/bin/env bash

num_speakers="
    SELECT
        COUNT(DISTINCT person)
    FROM
    speaker_rego
"
num_registered_speakers="
    SELECT
        COUNT(person)
    FROM
        speaker_rego
    WHERE
        id IS NOT NULL
"
num_unregistered_speakers="
    SELECT
        COUNT(person)
    FROM
        speaker_rego
    WHERE
        id IS NULL
"

registered_speakers="
    SELECT
        person.id,
        person.firstname,
        person.lastname,
        account.email_address,
        accommodation_location.name,
        diet,
        special
    FROM
        person,
        account,
        registration
    LEFT JOIN
        accommodation_option
    ON
        registration.accommodation_option_id = accommodation_option.id
    LEFT JOIN
        accommodation_location
    ON
        accommodation_location.id = accommodation_option.accommodation_location_id
    WHERE
        person.id = registration.person_id
        AND
        person.account_id = account.id
        AND
        registration.id IN (
                            SELECT
                                id
                            FROM
                                speaker_rego
                           )
    ORDER BY
        person.firstname
"



echo \#\#\# Registered Speakers \#\#\#
psql -t -c "$registered_speakers" 



echo \#\#\# Non-Registered Speakers \#\#\#
psql -t -c "
    SELECT
        person.id,
        person.firstname,
        person.lastname,
        account.email_address
    FROM
        person,
        account
    WHERE
        person.id IN (
                        SELECT
                            person
                        FROM
                            speaker_rego
                        WHERE
                            id IS NULL
                     ) 
        AND
        person.account_id = account.id
    ORDER BY
        person.firstname
"


echo -n "Number of Speakers: "
psql -t -c "$num_speakers"
echo -n "Registered speakers: "
psql -t -c "$num_registered_speakers" 
