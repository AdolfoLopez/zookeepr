#!/bin/bash
URL="http://flickr.com/services/feeds/photos_public.gne?format=rss_200"

for TAG in lca2007 linuxconfau; do
	/usr/bin/wget -qO - "$URL&tags=$TAG" | tr -d '\r' | /bin/sed '1,/<item>/d;s,^[[:space:]]*,,' | grep -e '^\(<title\|<link\|<media:thumbnail\|<dc:date.Taken\)' | /bin/sed 's#<title>\(.*\)</title>#Title: \1#;s#<link>\(.*\)</link>#Link: \1#;s#.* url="\(http://.*_s.jpg\).*#Thumb: \1\n@#;s#<dc:date.Taken>\(.*\)</dc:date.Taken>#Date: \1#' | while read LINE; do
		if [ "$LINE" == "@" ]; then
			echo "$DATE|<a href=\"$LINK\" title=\"$TITLE\"><img src=\"$THUMB\"></a>"
		else
			case $LINE in
				Title:*)
					TITLE=$(echo $LINE | sed 's#^.*: ##')
				;;
				Link:*)
					LINK=$(echo $LINE | sed 's#^.*: ##')
				;;
				Thumb:*)
					THUMB=$(echo $LINE | sed 's#^.*: ##')
				;;
				Date:*)
					DATE=$(echo $LINE | sed 's#^.*: ##')
				;;
			esac
		fi
	done
done | sort | uniq | cut -f 2 -d '|' | tail -n 9 | tr -d '\n'
