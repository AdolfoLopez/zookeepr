#!/bin/sh
IFS="#"
CURRENT=""
psql -t -AF "#" -c "select registration.company, person.firstname, person.lastname from registration, person where company is not NULL and registration.person_id = person.id and type = 'Professional' and (registration.id in (select rego from rego_invoice_payment where payment > 0) or registration.id in (select id from speaker_rego) or registration.id in (select registration.id from registration, discount_code where discount_code = discount_code.code)) order by company, lastname, firstname;" | \
while read COMPANY FIRSTNAME LASTNAME; do
	if [ "$COMPANY" != "$CURRENT" ]; then
		echo "$COMPANY"
	fi
	echo -e "\t$FIRSTNAME $LASTNAME"
	CURRENT="$COMPANY"
done
